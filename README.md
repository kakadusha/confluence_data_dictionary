[Автоматическое описание таблиц](https://kb.ertelecom.ru/pages/viewpage.action?pageId=281876683)
                 -  раздел с документацией

[clean_kb.py]()  -  Больше не используется. Скрипты очистки KB, в цикле ищет странцы и удаляет, снова ищет, пока не кончатся страницы



[Джоба Jenkins](https://spb99-jenkins.ertelecom.ru/job/DataEngineering/job/DQ/job/data_dictionary/)

[generate_conf.py]()
- по словарю описаний в папке [hive.comments/]() создаёт файл-конфиг conf.json для работы основного модуля
- производит создание метаузлов "name", "tables"
- отключает работу с партициями для всех таблиц (ставит skip_partitions=true), вроде бы по соображениям производительности (?)

[data_dictionary.py]()
- создаёт страницы kb по конфигу conf.json и словарю описаний [hive.comments/](), конфиг генерируется по словарю автоматически перед запуском
- использует файл credentials.json который создаётся перед запуском из шаблона [connections.json]()
- работает в два этапа: 
1.  на первом этапе MetaCollector собирает дополнительную информацию о таблицах из HIVE (поля, типы, примеры, проверка налиция описаний)
2.  на втором этвпе MetaPoster создаёт страницы и постит их в KB(Confluence)

[update_comments.py]()
- принимает параметром файл с комментариями
- для каждой базы данных: 
1.  получает из Hive типы данных
2.  добавляет комментарий из файла описания, делает ALTER TABLE .. CHANGE <колонка> ..

[hive.comments/]()
- словарь описаний, папка с отдельными описаниями баз с полями и комментариями, база - файл
- доступо свойство "sample_hide": true/false - скрывать примеры, true использовать при работе с личными данными
[hive.not_public/]() 
- спрятанные описания, эти таблицы не должны быть видны широкой общественности, не попадают в обработку
[ch.comments/]()     
- папка с отдельными описаниями баз ClickHouse с полями и комментариями, база - файл
[ch.not_public/]()          
- спрятанные описания, эти таблицы не должны быть видны широкой общественности, не попадают в обработку


[run.sh]()
- скрипт запуска Jenkins

[run_debug.sh]()
- скрипт запуска для отладки NB: используйте проброс портов на локальную машину из _debug




### JSON


[worklist.json]()      - список баз данных и таблиц которые подлежат обновлению, автогенерируется из hive.comments/ и ch.comments/ модулем [generate_conf.py]()


[connections_t.json]() - шаблон конфиг файла, пароли вынесены в переменные
[connections.json]()   - генерируется из шаблона с реальными паролями для работы, в гите не лежит



*ОТЛАДКА*
- хинты для локальной отладки:
   - готовый connections.json удобно скопировать из рабочей папки Jenkins
   - туннель на Hive c локального порта (sshtunnel2hive.sh), если прямое соединение не работает
   - туннель на СH c локального порта (sshtunnel2ch.sh), если прямое соединение не работает
   - если не видит библиотеку pyhive - выбрать конфигурация в vscode python3.8 (pyhive установлен туда)



### Запуск

    python3 clean_kb.py
    python3 generate_conf.py
    python3 data_dictionary.py

### Запуск с отладкой

    python3 clean_kb.py DEBUG
    python3 generate_conf.py DEBUG
    python3 data_dictionary.py DEBUG

    В отладочном случае используется другая [Parent-страница](https://kb.ertelecom.ru/display/BD/Data+dictionary+debug+parent)


*TODO*
- подробно описать обновленный вариант работы (без удаления страниц) 
- добавить поддержку CH в модуль update_comments.py
- сбор задач ведется также в таске [BIGD-642](https://ticket.ertelecom.ru/browse/BIGD-642)

